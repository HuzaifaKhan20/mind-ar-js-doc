(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{118:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return p})),a.d(t,"metadata",(function(){return f})),a.d(t,"toc",(function(){return d})),a.d(t,"UploadTab",(function(){return m})),a.d(t,"VisualizeTab",(function(){return O})),a.d(t,"Compile",(function(){return j})),a.d(t,"default",(function(){return g}));var n=a(3),r=a(0),o=a.n(r),c=a(124),i=a(190),s=a.n(i),l=a(147);a(142),a(126),a(116);var u=a(8);var b=function({children:e,fallback:t}){return u.a.canUseDOM&&null!=e?o.a.createElement(o.a.Fragment,null,e()):t||null};const p={id:"compile",title:"Image Targets Compiler"},f={unversionedId:"tools/compile",id:"tools/compile",isDocsHomePage:!1,title:"Image Targets Compiler",description:"const [error, setError] = useState('');",source:"@site/docs/tools/compile.mdx",slug:"/tools/compile",permalink:"/mind-ar-js-doc/tools/compile",version:"current",sidebar:"docs",previous:{title:"Core API",permalink:"/mind-ar-js-doc/core-api"}},d=[],m=({onDataReady:e})=>{const[t,a]=Object(r.useState)(""),[n,o]=Object(r.useState)(null),[i,u]=Object(r.useState)(null),b=Object(r.useRef)(null),p=new window.MINDAR.Compiler,f=Object(r.useCallback)((async e=>new Promise(((t,a)=>{let n=new Image;n.onload=()=>t(n),n.onerror=a,n.src=URL.createObjectURL(e)}))),[]),d=Object(r.useCallback)((async t=>{u(0);const a=[];for(let e=0;e<t.length;e++)a.push(await f(t[e]));console.log("files",t,a);const n=await p.compileImageTargets(a,(e=>{u(e.toFixed(2))})),r=await p.exportData();e(n,r)}),[]),m=Object(r.useCallback)((async t=>{var a=new FileReader;a.onload=async function(){const t=p.importData(this.result),a=await p.exportData();e(t,a)},a.readAsArrayBuffer(t)}),[]);Object(r.useEffect)((()=>{console.log("use effect",b.current);const e=new Dropzone(b.current,{url:"#",autoProcessQueue:!1,addRemoveLinks:!0});o(e)}),[]);const O=Object(r.useCallback)((async()=>{const e=n.files;if(0===e.length)return void a("please select images.");"mind"===e[0].name.split(".").pop()?m(e[0]):d(e)}),[n]);return Object(c.a)("div",null,Object(c.a)("p",null,"Select target images and start"),Object(c.a)("div",{ref:b,className:"dropzone"}),t&&Object(c.a)("p",{className:"text--danger"},t),Object(c.a)("div",{className:"padding-vert--md"},null===i&&Object(c.a)("button",{className:Object(l.a)("button","button--primary",s.a.startButton),onClick:O},"Start"),null!==i&&Object(c.a)("div",null,"Progress: ",i," %")))},O=({dataList:e,exportedBuffer:t})=>{const a=Object(r.useRef)(null),[n,o]=Object(r.useState)(0),[i,u]=Object(r.useState)(0),b=Object(r.useCallback)(((e,t,a,n,r=1)=>{e.beginPath(),e.arc(a,n,r,0,2*Math.PI,!1),e.fillStyle=t,e.lineWidth=1,e.strokeStyle=t,e.stroke()}),[]),p=Object(r.useCallback)(((e,t,a,n,r)=>{e.beginPath(),e.strokeStyle=t,e.rect(a-r/2,n-r/2,r,r),e.stroke()}),[]);Object(r.useEffect)((()=>{const t=e[n].imageList[i],r=e[n].matchingData[i].points,o=e[n].trackingData[i].points,c=a.current;c.width=t.width,c.height=t.height;const s=c.getContext("2d");s.clearRect(0,0,c.width,c.height);const l=new Uint8ClampedArray(t.width*t.height*4);for(let e=0;e<t.data.length;e++)l[4*e+0]=t.data[e],l[4*e+1]=t.data[e],l[4*e+2]=t.data[e],l[4*e+3]=255;const u=new ImageData(l,t.width,t.height);s.putImageData(u,0,0);for(let e=0;e<r.length;e++){const t=r[e];b(s,"#ff0000",Math.round(t.x),Math.round(t.y),t.scale)}for(let e=0;e<o.length;e++){const t=o[e];p(s,"#0000ff",Math.round(t.x),Math.round(t.y),44)}}),[e,n,i]);const f=Object(r.useMemo)((()=>e.map(((e,t)=>t))),[e]),d=Object(r.useMemo)((()=>e[n].imageList.map(((e,t)=>t))),[e,n]),m=Object(r.useMemo)((()=>{const t=100*e[n].imageList[i].scale;return{width:t+"%",maxHeight:"100%",top:(100-t)/2+"%"}}),[e,n,i]),O=Object(r.useCallback)((()=>{var e=new Blob([t]),a=window.document.createElement("a");a.download="targets.mind",a.href=window.URL.createObjectURL(e),a.click(),window.URL.revokeObjectURL(a.href)}),[t]);return Object(c.a)("div",null,Object(c.a)("div",{className:"tabs-container"},Object(c.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(l.a)("tabs")},f.map((e=>Object(c.a)("li",{role:"tab",className:Object(l.a)("tabs__item",{"tabs__item--active":n===e},s.a.tabItem),key:e,onClick:()=>{o(e)}},"Image ",e+1))))),Object(c.a)("div",{className:"tabs-container"},Object(c.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(l.a)("tabs")},d.map((e=>Object(c.a)("li",{role:"tab",className:Object(l.a)("tabs__item",{"tabs__item--active":i===e},s.a.tabItem),key:e,onClick:()=>{u(e)}},"Scale ",e+1))))),Object(c.a)("div",{className:s.a.visualizeCanvasWrapper},Object(c.a)("canvas",{style:m,className:s.a.visualizeCanvas,ref:a})),Object(c.a)("div",{className:"padding-vert--md"},Object(c.a)("button",{className:Object(l.a)("button","button--primary",s.a.startButton),onClick:O},"Download compiled")))},j=()=>{const[e,t]=Object(r.useState)("upload"),[a,n]=Object(r.useState)(null),[o,i]=Object(r.useState)(null),s=Object(r.useCallback)(((e,a)=>{n(e),i(a),t("visualize")}),[]);return Object(c.a)(b,{mdxType:"BrowserOnly"},(()=>Object(c.a)("div",null,"upload"===e&&Object(c.a)(m,{onDataReady:s,mdxType:"UploadTab"}),"visualize"===e&&Object(c.a)(O,{dataList:a,exportedBuffer:o,mdxType:"VisualizeTab"}))))},y={toc:d,UploadTab:m,VisualizeTab:O,Compile:j};function g({components:e,...t}){return Object(c.a)("wrapper",Object(n.a)({},y,t,{components:e,mdxType:"MDXLayout"}),Object(c.a)(j,{mdxType:"Compile"}))}g.isMDXComponent=!0},124:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),u=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(a),f=n,d=p["".concat(c,".").concat(f)]||p[f]||b[f]||o;return a?r.a.createElement(d,i(i({ref:t},l),{},{components:a})):r.a.createElement(d,i({ref:t},l))}));function f(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var l=2;l<o;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"},126:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}},142:function(e,t,a){"use strict";var n=a(0),r=a(143);t.a=function(){const e=Object(n.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},143:function(e,t,a){"use strict";var n=a(0);const r=Object(n.createContext)(void 0);t.a=r},147:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}},190:function(e,t,a){e.exports={startButton:"startButton_BGB-",visualizeCanvasWrapper:"visualizeCanvasWrapper_2KCN",visualizeCanvas:"visualizeCanvas_1hSp",tabItem:"tabItem_2bep"}}}]);