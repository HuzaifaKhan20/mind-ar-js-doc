(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{123:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return p})),a.d(t,"metadata",(function(){return f})),a.d(t,"toc",(function(){return j})),a.d(t,"UploadTab",(function(){return v})),a.d(t,"VisualizeTab",(function(){return O})),a.d(t,"Compile",(function(){return h})),a.d(t,"default",(function(){return g}));var n=a(3),r=a(7),c=a(202),i=a(203),o=a.n(i),s=a(0),u=a(134),l=a(205),b=a.n(l),d=a(157),m=(a(206),a(207),a(208)),p={id:"compile",title:"Image Targets Compiler"},f={unversionedId:"tools/compile",id:"tools/compile",isDocsHomePage:!1,title:"Image Targets Compiler",description:"const [error, setError] = useState('');",source:"@site/docs/tools/compile.mdx",slug:"/tools/compile",permalink:"/mind-ar-js-doc/tools/compile",version:"current",sidebar:"docs",previous:{title:"React",permalink:"/mind-ar-js-doc/more-examples/react"}},j=[],v=function(e){var t=e.onDataReady,a=Object(s.useState)(""),n=a[0],r=a[1],i=Object(s.useState)(null),l=i[0],m=i[1],p=Object(s.useState)(null),f=p[0],j=p[1],v=Object(s.useRef)(null),O=new window.MINDAR.IMAGE.Compiler,h=Object(s.useCallback)(function(){var e=Object(c.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var n=new Image;n.onload=function(){return e(n)},n.onerror=a,n.src=URL.createObjectURL(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),w=Object(s.useCallback)(function(){var e=Object(c.a)(o.a.mark((function e(a){var n,r,c,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j(0),n=[],r=0;case 3:if(!(r<a.length)){e.next=12;break}return e.t0=n,e.next=7,h(a[r]);case 7:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 9:r++,e.next=3;break;case 12:return console.log("files",a,n),e.next=15,O.compileImageTargets(n,(function(e){j(e.toFixed(2))}));case 15:return c=e.sent,e.next=18,O.exportData();case 18:i=e.sent,t(c,i);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),g=Object(s.useCallback)(function(){var e=Object(c.a)(o.a.mark((function e(a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new FileReader).onload=Object(c.a)(o.a.mark((function e(){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=O.importData(this.result),e.next=3,O.exportData();case 3:n=e.sent,t(a,n);case 5:case"end":return e.stop()}}),e,this)}))),n.readAsArrayBuffer(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);Object(s.useEffect)((function(){console.log("use effect",v.current);var e=new Dropzone(v.current,{url:"#",autoProcessQueue:!1,addRemoveLinks:!0});m(e)}),[]);var k=Object(s.useCallback)(Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=l.files).length){e.next=4;break}return r("please select images."),e.abrupt("return");case 4:"mind"===t[0].name.split(".").pop()?g(t[0]):w(t);case 6:case"end":return e.stop()}}),e)}))),[l]);return Object(u.a)("div",null,Object(u.a)("p",null,"Select target images and start"),Object(u.a)("div",{ref:v,className:"dropzone"}),n&&Object(u.a)("p",{className:"text--danger"},n),Object(u.a)("div",{className:"padding-vert--md"},null===f&&Object(u.a)("button",{className:Object(d.a)("button","button--primary",b.a.startButton),onClick:k},"Start"),null!==f&&Object(u.a)("div",null,"Progress: ",f," %")))},O=function(e){var t=e.dataList,a=e.exportedBuffer,n=Object(s.useRef)(null),r=Object(s.useState)(0),c=r[0],i=r[1],o=Object(s.useState)(0),l=o[0],m=o[1],p=Object(s.useCallback)((function(e,t,a,n,r){void 0===r&&(r=1),e.beginPath(),e.arc(a,n,r,0,2*Math.PI,!1),e.fillStyle=t,e.lineWidth=1,e.strokeStyle=t,e.stroke()}),[]);Object(s.useCallback)((function(e,t,a,n,r){e.beginPath(),e.strokeStyle=t,e.rect(a-r/2,n-r/2,r,r),e.stroke()}),[]);Object(s.useEffect)((function(){var e=t[c].imageList[l],a=[].concat(t[c].matchingData[l].maximaPoints,[t[c].matchingData[l].minimaPoints]),r=n.current;r.width=e.width,r.height=e.height;var i=r.getContext("2d");i.clearRect(0,0,r.width,r.height);for(var o=new Uint8ClampedArray(e.width*e.height*4),s=0;s<e.data.length;s++)o[4*s+0]=e.data[s],o[4*s+1]=e.data[s],o[4*s+2]=e.data[s],o[4*s+3]=255;var u=new ImageData(o,e.width,e.height);i.putImageData(u,0,0);for(var b=0;b<a.length;b++){var d=a[b];p(i,"#ff0000",Math.round(d.x),Math.round(d.y),d.scale)}}),[t,c,l]);var f=Object(s.useMemo)((function(){return t.map((function(e,t){return t}))}),[t]),j=Object(s.useMemo)((function(){return t[c].imageList.map((function(e,t){return t}))}),[t,c]),v=Object(s.useMemo)((function(){var e=100*t[c].imageList[l].scale;return{width:e+"%",maxHeight:"100%",top:(100-e)/2+"%"}}),[t,c,l]),O=Object(s.useCallback)((function(){var e=new Blob([a]),t=window.document.createElement("a");t.download="targets.mind",t.href=window.URL.createObjectURL(e),t.click(),window.URL.revokeObjectURL(t.href)}),[a]);return Object(u.a)("div",null,Object(u.a)("div",{className:"tabs-container"},Object(u.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(d.a)("tabs")},f.map((function(e){return Object(u.a)("li",{role:"tab",className:Object(d.a)("tabs__item",{"tabs__item--active":c===e},b.a.tabItem),key:e,onClick:function(){i(e),m(0)}},"Image ",e+1)})))),Object(u.a)("div",{className:"tabs-container"},Object(u.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(d.a)("tabs")},j.map((function(e){return Object(u.a)("li",{role:"tab",className:Object(d.a)("tabs__item",{"tabs__item--active":l===e},b.a.tabItem),key:e,onClick:function(){m(e)}},"Scale ",e+1)})))),Object(u.a)("div",{className:b.a.visualizeCanvasWrapper},Object(u.a)("canvas",{style:v,className:b.a.visualizeCanvas,ref:n})),Object(u.a)("div",{className:"padding-vert--md"},Object(u.a)("button",{className:Object(d.a)("button","button--primary",b.a.startButton),onClick:O},"Download compiled")))},h=function(){var e=Object(s.useState)("upload"),t=e[0],a=e[1],n=Object(s.useState)(null),r=n[0],c=n[1],i=Object(s.useState)(null),o=i[0],l=i[1],b=Object(s.useCallback)((function(e,t){c(e),l(t),a("visualize")}),[]);return Object(u.a)(m.a,{mdxType:"BrowserOnly"},(function(){return Object(u.a)("div",null,"upload"===t&&Object(u.a)(v,{onDataReady:b,mdxType:"UploadTab"}),"visualize"===t&&Object(u.a)(O,{dataList:r,exportedBuffer:o,mdxType:"VisualizeTab"}))}))},w={toc:j,UploadTab:v,VisualizeTab:O,Compile:h};function g(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(u.a)("wrapper",Object(n.a)({},w,a,{components:t,mdxType:"MDXLayout"}),Object(u.a)(h,{mdxType:"Compile"}))}g.isMDXComponent=!0},205:function(e,t,a){e.exports={startButton:"startButton_BGB-",visualizeCanvasWrapper:"visualizeCanvasWrapper_2KCN",visualizeCanvas:"visualizeCanvas_1hSp",tabItem:"tabItem_2bep"}}}]);